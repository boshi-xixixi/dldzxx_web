# 项目架构说明文档

## 📋 目录
- [系统架构概览](#系统架构概览)
- [前端架构](#前端架构)
- [后端架构](#后端架构)
- [数据流设计](#数据流设计)
- [组件设计](#组件设计)
- [状态管理](#状态管理)
- [路由设计](#路由设计)
- [API 设计](#api-设计)
- [部署架构](#部署架构)

## 🏗️ 系统架构概览

企业网络监控数据大屏系统采用前后端分离的架构设计，基于现代化的 Web 技术栈构建。

```
┌─────────────────────────────────────────────────────────────┐
│                    用户界面层 (UI Layer)                      │
├─────────────────────────────────────────────────────────────┤
│  Vue 3 + TypeScript + TDesign + Tailwind CSS + ECharts    │
├─────────────────────────────────────────────────────────────┤
│                   业务逻辑层 (Business Layer)                │
├─────────────────────────────────────────────────────────────┤
│              Vue Router + Pinia + Composables              │
├─────────────────────────────────────────────────────────────┤
│                   数据访问层 (Data Layer)                    │
├─────────────────────────────────────────────────────────────┤
│                  HTTP Client + API Services                │
├─────────────────────────────────────────────────────────────┤
│                   后端服务层 (Backend Layer)                 │
├─────────────────────────────────────────────────────────────┤
│              Node.js + Express + TypeScript                │
└─────────────────────────────────────────────────────────────┘
```

## 🎨 前端架构

### 技术栈选择

- **Vue 3**: 采用 Composition API，提供更好的类型推导和代码组织
- **TypeScript**: 提供类型安全，减少运行时错误
- **Vite**: 快速的开发构建工具，支持 HMR
- **TDesign Vue Next**: 企业级 UI 组件库
- **Tailwind CSS**: 实用优先的 CSS 框架
- **ECharts**: 数据可视化图表库

### 目录结构设计

```
src/
├── components/          # 公共组件
│   ├── common/         # 通用组件
│   ├── charts/         # 图表组件
│   └── layout/         # 布局组件
├── pages/              # 页面组件
│   ├── Dashboard/      # 数据大屏
│   ├── Employees/      # 员工管理
│   ├── Devices/        # 设备管理
│   └── AiChat/         # AI 助手
├── router/             # 路由配置
├── stores/             # 状态管理
├── types/              # 类型定义
├── utils/              # 工具函数
├── composables/        # 组合式函数
└── assets/             # 静态资源
```

### 组件架构

```
App.vue
├── Layout/
│   ├── Header/
│   ├── Sidebar/
│   └── Main/
│       └── RouterView/
│           ├── Dashboard/
│           ├── Employees/
│           ├── Devices/
│           └── AiChat/
```

## 🔧 后端架构

### 技术栈

- **Node.js**: JavaScript 运行时环境
- **Express**: Web 应用框架
- **TypeScript**: 类型安全的服务端开发
- **CORS**: 跨域资源共享

### 服务架构

```
api/
├── routes/             # API 路由
│   ├── employees.ts    # 员工相关 API
│   ├── devices.ts      # 设备相关 API
│   ├── dashboard.ts    # 数据大屏 API
│   └── chat.ts         # AI 聊天 API
├── middleware/         # 中间件
├── utils/              # 工具函数
├── types/              # 类型定义
└── server.ts           # 服务器入口
```

## 🔄 数据流设计

### 前端数据流

```
User Action → Component → Composable → API Service → Backend
     ↓
Component ← Store ← Response ← HTTP Client ← API Response
```

### 状态管理流程

```
Component Trigger → Action → Mutation → State → Reactive Update → UI
```

## 🧩 组件设计

### 组件分类

1. **页面组件 (Pages)**
   - 路由级别的组件
   - 负责页面整体布局和数据获取
   - 例：`DashboardPage.vue`、`EmployeePage.vue`

2. **布局组件 (Layout)**
   - 应用整体布局结构
   - 例：`AppLayout.vue`、`Sidebar.vue`、`Header.vue`

3. **业务组件 (Business)**
   - 特定业务逻辑的组件
   - 例：`EmployeeCard.vue`、`DeviceStatus.vue`

4. **通用组件 (Common)**
   - 可复用的基础组件
   - 例：`LoadingSpinner.vue`、`ConfirmDialog.vue`

### 组件通信

```
Parent Component
├── Props Down ↓
├── Events Up ↑
├── Provide/Inject (跨层级)
└── Store (全局状态)
```

## 📊 状态管理

### Pinia Store 设计

```typescript
// stores/dashboard.ts
export const useDashboardStore = defineStore('dashboard', {
  state: () => ({
    networkStatus: {},
    alerts: [],
    statistics: {}
  }),
  
  getters: {
    criticalAlerts: (state) => state.alerts.filter(alert => alert.level === 'critical')
  },
  
  actions: {
    async fetchNetworkStatus() {
      // API 调用逻辑
    }
  }
})
```

### 状态分类

1. **全局状态**: 用户信息、主题设置、权限等
2. **页面状态**: 页面特定的数据和 UI 状态
3. **组件状态**: 组件内部的临时状态

## 🛣️ 路由设计

### 路由结构

```typescript
const routes = [
  {
    path: '/',
    name: 'Dashboard',
    component: () => import('@/pages/Dashboard/DashboardPage.vue')
  },
  {
    path: '/employees',
    name: 'Employees',
    component: () => import('@/pages/Employees/EmployeePage.vue')
  },
  {
    path: '/devices',
    name: 'Devices',
    component: () => import('@/pages/Devices/DevicePage.vue')
  },
  {
    path: '/ai-chat',
    name: 'AiChat',
    component: () => import('@/pages/AiChat/AiChatPage.vue')
  }
]
```

### 路由守卫

```typescript
router.beforeEach((to, from, next) => {
  // 权限检查
  // 登录状态验证
  // 页面访问控制
})
```

## 🔌 API 设计

### RESTful API 规范

```
GET    /api/employees          # 获取员工列表
POST   /api/employees          # 创建员工
GET    /api/employees/:id      # 获取员工详情
PUT    /api/employees/:id      # 更新员工信息
DELETE /api/employees/:id      # 删除员工

GET    /api/devices            # 获取设备列表
GET    /api/devices/:id/status # 获取设备状态

GET    /api/dashboard/stats    # 获取统计数据
GET    /api/dashboard/alerts   # 获取告警信息

POST   /api/chat/message       # 发送聊天消息
```

### API 响应格式

```typescript
interface ApiResponse<T> {
  code: number
  message: string
  data: T
  timestamp: number
}
```

## 🚀 部署架构

### 开发环境

```
Developer Machine
├── Frontend (Vite Dev Server) :5173
└── Backend (Node.js + Nodemon) :3001
```

### 生产环境

```
Vercel Platform
├── Static Files (Frontend Build)
├── Serverless Functions (API Routes)
└── CDN (Global Distribution)
```

### 构建流程

```
Source Code → TypeScript Compilation → Vite Build → Static Files → Deployment
```

## 🔒 安全架构

### 前端安全

1. **XSS 防护**: 使用 Vue 的模板语法自动转义
2. **CSRF 防护**: 使用 CSRF Token
3. **内容安全策略**: 配置 CSP 头部

### 后端安全

1. **CORS 配置**: 限制跨域访问
2. **输入验证**: 验证所有输入参数
3. **错误处理**: 避免敏感信息泄露

## 📈 性能优化

### 前端优化

1. **代码分割**: 路由级别的懒加载
2. **组件缓存**: 使用 `keep-alive`
3. **图片优化**: 使用 WebP 格式和懒加载
4. **打包优化**: Tree-shaking 和压缩

### 后端优化

1. **响应缓存**: 缓存频繁访问的数据
2. **数据压缩**: 启用 gzip 压缩
3. **连接池**: 数据库连接池管理

## 🔍 监控和日志

### 前端监控

1. **错误监控**: 捕获和上报 JavaScript 错误
2. **性能监控**: 页面加载时间和用户交互
3. **用户行为**: 用户操作路径分析

### 后端监控

1. **API 监控**: 响应时间和错误率
2. **系统监控**: CPU、内存使用情况
3. **日志管理**: 结构化日志记录

## 🧪 测试架构

### 测试策略

1. **单元测试**: 组件和函数级别测试
2. **集成测试**: API 接口测试
3. **端到端测试**: 用户流程测试

### 测试工具

- **Vitest**: 单元测试框架
- **Vue Test Utils**: Vue 组件测试
- **Cypress**: 端到端测试

---

本架构文档将随着项目的发展持续更新和完善。